<template name="AdminDashboard">
	{{#each adminWidgets}}
	{{> UI.dynamic template=template data=data}}
	{{else}}
	{{> adminDefaultWidgets}}
	{{/each}}
</template>

<template name="AdminDashboardNew">
	{{> adminAlert}}
	{{#if adminTemplate admin_collection_name 'new'}}
		{{#with adminTemplate admin_collection_name 'new'}}
		{{> UI.dynamic template=name data=data }}
		{{/with}}
	{{else}}
		<div class="box box-default">
			<div class="box-body">
				{{> quickForm id="admin_insert" collection=admin_collection fields=admin_fields omitFields=admin_omit_fields buttonContent='Create'}}
			</div>
		</div>
	{{/if}}
</template>

<template name="AdminDashboardEdit">
	{{> adminAlert}}
	{{#if adminTemplate admin_collection_name 'edit'}}
		{{#with adminTemplate admin_collection_name 'edit'}}
		{{> UI.dynamic template=name data=data }}
		{{/with}}
	{{else}}
		<div class="box box-default">
			<div class="box-body">
				{{#if admin_current_doc}}
				{{> quickForm id="admin_update" collection=admin_collection doc=admin_current_doc fields=admin_fields omitFields=admin_omit_fields buttonContent='Update'}}
				{{/if}}
			</div>
		</div>
	{{/if}}
</template>

<template name="AdminDashboardViewWrapper">
	<div></div>
	{{! This template is used to manually re-render AdminDashboardView on route transition }}
</template>

<template name="AdminDashboardView">
	{{> adminAlert}}
	{{#if adminTemplate admin_collection_name 'view'}}
		{{#with adminTemplate admin_collection_name 'view'}}
		{{> UI.dynamic template=name data=data }}
		{{/with}}
	{{else}}
		{{#if hasDocuments}}
			{{> tabular table=admin_table class="table dataTable"}}
		{{else}}
			<div class="alert alert-info">
				<p>There are no visible items in this collection.</p>
				<p><a href="{{newPath}}" class="btn btn-primary"><i class="fa fa-plus"></i> Add one</a></p>
			</div>
		{{/if}}
	{{/if}}
</template>

<template name="AdminDashboardusersView">
    {{> adminAlert}}
    <p><a href="{{newPath}}" class="btn btn-primary"><i class="fa fa-plus"></i> Add one</a></p>
    {{#if hasDocuments}}
        {{> tabular table=admin_table class="table dataTable"}}
    {{else}}
        <div class="alert alert-info">
            <p>There are no visible items in this collection.</p>
        </div>
    {{/if}}
</template>
<template name="AdminDashboardusersNew">
	<div class="box box-default">
		<div class="box-body">
			{{> adminAlert}}
			{{# autoForm id="adminNewUser" schema=AdminSchemas.newUser type="method" meteormethod="adminNewUser"}}

			{{>afQuickField name="email"}}
			{{>afQuickField name="chooseOwnPassword"}}

			{{#if afFieldValueIs name="chooseOwnPassword" value=false}}

			{{>afQuickField name="password"}}
			{{>afQuickField name="sendPassword"}}

			{{/if}}

			<button type="submit" class="btn btn-primary">Add User</button>

			{{/autoForm}}
		</div>
	</div>
</template>

<template name="AdminDashboardusersEdit">
	<div class="box box-default">
		<div class="box-body">
			{{> adminAlert}}

			<h4>User Roles</h4>
			<img class="home-spinner hide" alt="spinner" src="/imgs/spinner.gif" />
			{{#each getUserRoles admin_current_id}}
			<button class="btn btn-primary btn-xs {{#if isInRole 'manage_user_role' }}btn-remove-role{{/if}}" role="{{this}}" user="{{admin_current_id}}">{{this}}</button>
			{{/each}}
			{{#if isInRole 'manage_user_role'}}
				{{#each getOtherRoles admin_current_id}}
				<button class="btn btn-default btn-xs btn-add-role" role="{{this}}" user="{{admin_current_id}}">{{this}}</button>
				{{/each}}
				{{#if getUserRoles admin_current_id}}
				<p style="margin-top:5px;">Click a role to toggle it.</p>
				{{else}}
				<p>User not in any roles. Click a role to add it to a user.</p>
				{{/if}}
			{{else}}
				{{#unless getUserRoles admin_current_id}}
					<p style="margin-top:5px;">User not in any roles.</p>
				{{/unless}}
			{{/if}}

			<hr/>

        <h4>Location History</h4>
        <p>Track user location for last 24 hours.</p>
        <div class="map-container">
            {{> googleMap name="locationHistory" options=locationHistoryMapOptions}}
        </div>
        <hr />

			<h4>Reset Password</h4>
			{{#autoForm id="adminSendResetPasswordEmail" schema=AdminSchemas.sendResetPasswordEmail type="method" meteormethod="adminSendResetPasswordEmail"}}
			<div class="form-group hidden">
				<label class="control-label">ID</label>
				<input value="{{admin_current_id}}" type="text" name="_id" omitfields="createdAtupdatedAt" required="" data-schema-key="_id" class="form-control" autocomplete="off" />
				<span class="help-block"></span>
			</div>
			<p>Send a reset password email to {{admin_current_doc.emails.[0].address}}</p>
			<button type="submit" class="btn btn-primary btn-sm">Send Email</button>
			{{/autoForm}}

			<hr/>
			<h4>Change Password</h4>
			{{#autoForm id="adminChangePassword" schema=AdminSchemas.changePassword type="method" meteormethod="adminChangePassword"}}
			<div class="form-group hidden">
				<label class="control-label" for="title">ID</label>
				<input value="{{admin_current_id}}" type="text" name="_id" omitfields="createdAtupdatedAt" required="" data-schema-key="_id" class="form-control" autocomplete="off" />
				<span class="help-block"></span>
			</div>
			{{>afQuickField name="password"}}
			<button type="submit" class="btn btn-primary btn-sm">Change Password</button>
			{{/autoForm}}
		</div>
	</div>
</template>

<template name="adminAlert">
	{{#if $.Session.get 'adminSuccess'}}
	<div class="alert alert-success admin-alert">
		{{$.Session.get 'adminSuccess'}}
	</div>
	{{/if}}

	{{#if $.Session.get 'adminError'}}
	<div class="alert alert-danger admin-alert">
		{{$.Session.get 'adminError'}}
	</div>
	{{/if}}
</template>

<template name="adminUsersMailBtn">
	<a href="mailto:{{adminUserEmail value}}" class="btn btn-default btn-xs"><i class="fa fa-envelope"></i></a>
</template>

<template name="adminEditBtn">
	<a href="{{path}}" class="hidden-xs btn btn-xs btn-primary"><i class="fa fa-pencil"></i></a>
	<a href="{{path}}" class="visible-xs btn btn-sm btn-primary"><i class="fa fa-pencil"></i> Edit</a>
</template>

<template name="adminDeleteBtn">
	<a data-toggle="modal" doc="{{_id}}" href='#admin-delete-modal' class="hidden-xs btn btn-xs btn-danger btn-delete"><i class="fa fa-times" doc="{{_id}}"></i></a>
	<a data-toggle="modal" doc="{{_id}}" href='#admin-delete-modal' class="visible-xs btn btn-sm btn-danger btn-delete"><i class="fa fa-times" doc="{{_id}}"></i> Delete</a>
</template>

<template name="AdminRoleManager">
	<form id="js-frm-role-manager">
		<input type="submit" class="btn btn-primary js-update" value="Save" />
		<input type="submit" class="btn btn-warning js-reset" value="Reset" />
    <div class="table-responsive">
        <table id="roleManagerTable" class="table table-striped table-hover">
          <thead>
            <th></th>
            {{#each getHomeRoles}}
              <th>{{title}}</th>
            {{/each}}
          </thead>
          <tbody>
            {{#each permission in getPermissions}}
              <tr>
                <td>{{permission.name}}</td>
                {{#each getHomeRoles}}
                  <td><input class="js-tooltip" type="checkbox" name="rolePermissions[{{permission.name}}][{{title}}]" value="1" data-toggle="tooltip" data-placement="right" title="{{permission.name}} -> {{title}}" {{isPermissionInRole permission.name}} /></td>
                {{/each}}
              </tr>
            {{/each}}
          </tbody>
          <tfoot>
            <th></th>
            {{#each getHomeRoles}}
              <th>{{title}}</th>
            {{/each}}
          </tfoot>
        </table>
    </div>
		<input type="submit" class="btn btn-primary js-update" value="Save" />
		<input type="submit" class="btn btn-warning js-reset" value="Reset" />
	</form>
</template>

<template name="AdminSettings">
	{{> adminAlert}}
	{{> quickForm
		id="adminSettingsForm"
		schema="Schemas.adminSettings"
		type="method"
		meteormethod="saveAdminSettings"
		template="bootstrap3"
		label-class="sr-only"
		afFieldInput-placeholder="schemaLabel"
		doc=getAdminSettings
	}}
</template>
